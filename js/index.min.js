function urlParam(e){var o=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null===o?"":decodeURIComponent(o[1])}function urlNotFound(e){function o(e,o,r){r?a.append('<tr class="error"><td>'+e+"</td><td>"+o+"</td></tr>"):a.append("<tr><td>"+e+"</td><td>"+o+"</td></tr>")}var a=$("#not-found-modal-table"),r=$("#not-found-modal-type");switch(a.html(""),r.html(""),r.html(e),e){case"Course":o("Course",url.course,!0);break;case"Year":o("Course",url.course,!1),o("Year",url.year,!0);break;case"Doc":o("Course",url.course,!1),o("Year",url.year,!1),o("Doc",url.doc,!0);break;case"Course2":o("Course2",url.course2,!0);break;case"Year2":o("Course2",url.course2,!1),o("Year2",url.year2,!0);break;case"Doc2":o("Course2",url.course2,!1),o("Year2",url.year2,!1),o("Doc2",url.doc2,!0)}$("#not-found-modal").modal({duration:200,onApprove:function(){url.course="",url.year="",url.doc="",setTimeout(function(){$("#"+e.toLowerCase()+"-dropdown").dropdown("show")},200)}}).modal("show")}function populateDropdown(e,o,a,r){if("object"==typeof e){var d=[];for(i=0;i<e.length;i++)d.push(e[i][o]);for(d.sort(),r&&d.reverse(),$(a).empty(),j=0;j<d.length;j++)$(a).append('<div class="item" data-value"1">'+d[j]+"</div>")}else console.error("Input JSON not an object: "+e),alert("Error:\n\nInput JSON not an object: "+e)}function userSelect(e,o,a,r,d,t,s,n,l){console.warn("userselect");var c=$("#"+e+"-input"+o);if(a)var u=$("#"+a+"-dropdown"+o),i=$("#"+a+"-menu"+o);c.change(function(){for(console.warn("input change"),selected[e]=c[0].value,params[e]=selected[e],a&&u.addClass("loading").removeClass("disabled"),k=0;k<r.length;k++)if(r[k][d].toLowerCase()==selected[e]){selected[s]=k;break}if(!selected[s])return console.error(e+" not found"),void alert(e+" not found");a&&(populateDropdown(r[selected[s]][t],a,i,n),u.removeClass("loading").dropdown("restore defaults").dropdown("show").dropdown({selectOnKeydown:!1}),url[a]&&(u.dropdown("set selected",url[a]).dropdown("hide"),u.dropdown("get value")||urlNotFound(a))),history.pushState(null,"","?"+$.param(params)),l&&l()})}function loadJSON(e,o,a,r){if("undefined"!=typeof Storage){var d=!0,t=localStorage.getItem("timestamp");if(null!==t){(new Date).getTime()-new Date(t).getTime()<6048e5&&(d=!1)}else{var s=new Date;localStorage.setItem("timestamp",s),console.log("Local storage - set new download date: "+s)}var n=localStorage.getItem(o);if(null!==n&&!1===d){console.log("Serving from LocalStorage: "+o);try{r(JSON.parse(n))}catch(e){var l="Failed to parse "+o+" JSON from cache.\n"+e;console.error(l),alert(l+"\n\nPress OK to reload."),localStorage.removeItem(o),location.reload()}}else console.log("Downloading: "+o),ajaxJSON(e,o,a,function(e){console.log("Downloaded and cached: "+o),localStorage.setItem(o,JSON.stringify(e)),r(e)})}else console.log("LocalStorage not available: "+o),ajaxJSON(e,o,a,function(e){r(e)})}function ajaxJSON(e,o,a,r){null!==a?$.ajax({dataType:"json",url:e,xhr:a,success:r}):$.ajax({dataType:"json",url:e,success:r})}function dataProgress(){console.log("Downloading data...");var e=new window.XMLHttpRequest;return e.addEventListener("progress",function(e){var o=Math.floor(e.loaded/1269870*100);$("#loadingbar").progress({percent:o}),$("#loadingpercent").html(o+"%")},!1),e}function dataReceived(e){console.log("Received data"),populateDropdown(jsonData=e,"course_name","#course-menu",!1),populateDropdown(jsonData,"course_name","#course-menu2",!1),$("#loadingpercent").html("100%"),$("#loadingbar").progress({percent:100}).delay(500).fadeOut(200),$("body").removeClass("loading"),$("iframe").contents().find("body").append("<div style=\"align-items:center;display:flex;height:100%;justify-content:center;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;cursor:default;text-align:center;user-select:none;font-size:1.5em;color:rgba(255,255,255,.5)\">Select a Course, Year, and Document above</div>"),$("#course-dropdown").removeClass("disabled").dropdown("show").dropdown({selectOnKeydown:!1}),$("#course-dropdown2").removeClass("disabled").dropdown({selectOnKeydown:!1}),userSelect("course","","year",jsonData,"course_name","packs","courseIndex",!0),url.course&&($("#course-dropdown").dropdown("set selected",url.course).dropdown("hide"),$("#course-dropdown").dropdown("get value")||urlNotFound("Course")),url.course2&&($("#course-dropdown2").dropdown("set selected",url.course2).dropdown("hide"),$("#course-dropdown2").dropdown("get value")||urlNotFound("Course2"))}function showTimestamp(e){console.log("Received meta"),timestamp=new Date(e.timestamp),$("#timestamp").html(timestamp.toLocaleDateString())}function timerIncrement(){(idleTime+=5)>=5&&!0===dimmable&&$("body").addClass("idle")}function resetTimer(){idleTime=-5,$("body").removeClass("idle")}function updateTabTitle(){"Document"!=$("#doc-dropdown .text.overflow").html()?(document.title=$("#year-dropdown .text").html()+" "+$("#course-dropdown .text").html()+" "+$("#doc-dropdown .text.overflow").html(),$("body").hasClass("split")&&"Document"!=$("#doc-dropdown2 .text.overflow").html()&&(document.title+=" | "+$("#year-dropdown2 .text").html()+" "+$("#course-dropdown2 .text").html()+" "+$("#doc-dropdown2 .text.overflow").html())):document.title="HSCPastPapers.com"}var jsonData,timestamp,version="1.8.0",selected={},url={},params={};$("#year-input").change(function(){if(""!==$(this)[0].value){for(selected.year=$("#year-input")[0].value,params.year=selected.year,$("#doc-dropdown").addClass("loading").removeClass("disabled"),l=0;l<jsonData[selected.courseIndex].packs.length;l++)if(jsonData[selected.courseIndex].packs[l].year==selected.year){selected.yearIndex=l;break}populateDropdown(jsonData[selected.courseIndex].packs[selected.yearIndex].docs,"doc_name","#doc-menu",!1),$("#doc-dropdown").removeClass("loading").dropdown("restore defaults").dropdown("show"),url.doc&&($("#doc-dropdown").dropdown("set selected",url.doc).dropdown("hide"),$("#doc-dropdown").dropdown("get value")||urlNotFound("Doc")),$(".button-exampack").removeClass("disabled").attr("href",jsonData[selected.courseIndex].packs[selected.yearIndex].link),history.pushState(null,"","?"+$.param(params))}}),$("#doc-input").change(function(){if(""!=$(this)[0].value){for(selected.doc=$("#doc-input")[0].value,params.doc=selected.doc,m=0;m<jsonData[selected.courseIndex].packs[selected.yearIndex].docs.length;m++)if(jsonData[selected.courseIndex].packs[selected.yearIndex].docs[m].doc_name.toLowerCase()==selected.doc){selected.docLink=jsonData[selected.courseIndex].packs[selected.yearIndex].docs[m].doc_link,selected.docLink=selected.docLink.replace("http","https");break}$("#iframe").attr("src",selected.docLink),$("#loader").addClass("active"),$(".button-download").removeClass("disabled").attr("href",selected.docLink),$(".button-link").removeClass("disabled").removeAttr("disabled"),$("#pdf-dropdown").removeClass("disabled").dropdown({action:"nothing"}),history.pushState(null,"","?"+$.param(params)),updateTabTitle(),dimmable=!0}}),$("#clear-cache").click(function(){localStorage.clear(),location.reload()}),$(document).ready(function(){$("#nojquery").hide(),$("#about-modal").modal({duration:200}),$("#version").html(version),url.course=urlParam("course"),url.year=urlParam("year"),url.doc=urlParam("doc"),url.course2=urlParam("course2"),url.year2=urlParam("year2"),url.doc2=urlParam("doc2"),"about"==urlParam("open")&&$("#about-modal").modal("show"),params={mode:"normal"},$("#more-dropdown").dropdown({action:"nothing"}),loadJSON("data/data.json","data",dataProgress,dataReceived),loadJSON("data/meta.json","meta",null,showTimestamp)}),$(".button-link").click(function(){prompt("Copy link below:",selected.docLink)}),$(".button-about").click(function(){$("#about-modal").modal("show")}),$("#close-modal").click(function(){"about"==urlParam("open")&&history.pushState(null,"","?")}),$("#iframe").on("load",function(){$("#loader").removeClass("active")});var idleTime=0,dimmable=!1;$(document).ready(function(){setInterval(timerIncrement,5e3);$(this).mousemove(function(e){resetTimer()}),$(this).mousedown(function(e){resetTimer()}),$(this).mouseup(function(e){resetTimer()}),$(this).keypress(function(e){resetTimer()})}),$(document).ready(function(){"split"==urlParam("mode")&&($("body").addClass("split"),$("#course-dropdown2").dropdown("show"),params.mode="split")}),$(".button-split").click(function(){$("body").addClass("split"),selected.course2||selected.year2||selected.doc2||$("#course-dropdown2").dropdown("show"),params.mode="split",history.pushState(null,"","?"+$.param(params)),updateTabTitle()}),$(".button-splitexit").click(function(){$("body").removeClass("split"),params.mode="normal",history.pushState(null,"","?"+$.param(params)),updateTabTitle()}),$("#course-input2").change(function(){for(selected.course2=$("#course-input2")[0].value,params.course2=selected.course2,$("#year-dropdown2").addClass("loading").removeClass("disabled"),k=0;k<jsonData.length;k++)if(jsonData[k].course_name.toLowerCase()==selected.course2){selected.courseIndex2=k;break}populateDropdown(jsonData[selected.courseIndex2].packs,"year","#year-menu2",!0),$("#year-dropdown2").removeClass("loading").dropdown("restore defaults").dropdown("show").dropdown({selectOnKeydown:!1}),url.year2&&($("#year-dropdown2").dropdown("set selected",url.year2).dropdown("hide"),$("#year-dropdown2").dropdown("get value")||urlNotFound("Year2")),history.pushState(null,"","?"+$.param(params))}),$("#year-input2").change(function(){if(""!==$(this)[0].value){for(selected.year2=$("#year-input2")[0].value,params.year2=selected.year2,$("#doc-dropdown2").addClass("loading").removeClass("disabled"),l=0;l<jsonData[selected.courseIndex2].packs.length;l++)if(jsonData[selected.courseIndex2].packs[l].year==selected.year2){selected.yearIndex2=l;break}populateDropdown(jsonData[selected.courseIndex2].packs[selected.yearIndex2].docs,"doc_name","#doc-menu2",!1),$("#doc-dropdown2").removeClass("loading").dropdown("restore defaults").dropdown("show"),url.doc2&&($("#doc-dropdown2").dropdown("set selected",url.doc2).dropdown("hide"),$("#doc-dropdown2").dropdown("get value")||urlNotFound("Doc2")),history.pushState(null,"","?"+$.param(params))}}),$("#doc-input2").change(function(){if(""!==$(this)[0].value){for(selected.doc2=$("#doc-input2")[0].value,params.doc2=selected.doc2,m=0;m<jsonData[selected.courseIndex2].packs[selected.yearIndex2].docs.length;m++)if(jsonData[selected.courseIndex2].packs[selected.yearIndex2].docs[m].doc_name.toLowerCase()==selected.doc2){selected.docLink2=jsonData[selected.courseIndex2].packs[selected.yearIndex2].docs[m].doc_link,selected.docLink2=selected.docLink2.replace("http","https");break}$("#iframe-split-right").attr("src",selected.docLink2),$("#loader").addClass("active"),history.pushState(null,"","?"+$.param(params)),updateTabTitle(),dimmable=!0}}),$("#iframe-split-right").on("load",function(){$("#loader").removeClass("active")});